# 《Mirror And Flowers》项目介绍

## 项目架构

​		本项目采用C/S架构模式，基于TCP协议传输数据，对于**客户端**和**服务器端**采用Data-Tool-UI三层架构方式进行构建，下面分别介绍客户端和服务器段的各层需要执行的功能。



### 客户端

---

* Data层：

    客户端的数据层需要存有客户端运行时所需的**最主要**的数据。需要存放**机器信息**（如主机名等），需要记录对战**双方**的**角色信息**，需要一个容器在运行时**读入**卡牌的所有**信息**，需要一个容器记录当前卡组信息（如**卡牌ID**），需要记录连接的**服务器端**的信息，需要一个容器记录**消息**，需要一个容器存放UI界面的相关数据，或直接存放UI界面窗体的指针。

    **数据层只负责提供数据和修改数据的接口**。

* Tool层：

    客户端的Tool层需要拥有对Data层的数据**读入**并**处理**的功能。需要有用于**连接服务器**的连接器，需要有**指令系统**的实现（方案1：一个处理器和一个context，还有执行具体功能的类。方案2：添加反射机制将指令系统扩展成类似插件的模块，需要一个context、一个factory、一个register，和具体的类。在具体类中执行相应功能，并提供生成该指令的方法），需要有**数据发送器**和**接收器**（或者一个**连接器**内**组合**了socket，使用socket的内置方法完成数据的发送和接收），需要有JSON文件的**读取器**和修改器。

* UI层：

    客户端的UI层需要拥有对数据**显示**的功能，且**尽量不进行数据的修改处理**，UI初始化需要依靠外部**JSON文件**的读取。

    

### 服务器端

---

* Data层：

    服务器端的数据层需要存放**已连接的客户端**的信息，包括客户端地址、当前状态、所选角色信息、当前回合操作队列等，需要一个容器存放已连接的客户端列表和正匹配的客户端列表，需要一个容器存放服务器消息，需要一个容器读取所有卡牌信息，

* Tool层：

    服务器的工具层应该有对Data层的数据读入并处理的功能，包括实现战斗逻辑，指令处理、连接处理、JSON文件读取和修改、发送数据和接收数据。

* UI层：

    服务器的ui只需要有一个启动和关闭服务器的选项、一个在线列表和状态列表，一个匹配队列、一个服务器消息栏和消息发送框即可。

### 后续扩展-模拟运维

---

* 添加文件传输功能-角色池、卡池更新、新增buff系统等
* 更新客户端的UI界面，通过调整JSON文件内容完成。



### 项目规范

---

* 代码规范：

    1. 变量命名规则：

        **成员变量**命名为 m_ +小驼峰命名法，需要明确变量的名字和意义。

        **临时变量**不需要加m_，但依然需要使用小驼峰命名法，初始化函数中传入参数名应与成员变量对应。

        **静态变量**加入前缀 “s_”。

        **全局变量**应加入前缀“g_”。

        **函数命名**采用大驼峰命名规则，对于特定意义的函数采用Init描述初始化函数、Get描述成员变量获取函数、Set描述变量重设函数、To描述转化函数、Solute描述处理函数、Show/Hide+窗体名描述展示函数。

    2. 注释书写规则：

        对于**类的作用**的介绍应在每个类的声明前进行解释，需要介绍类的功能和拥有的方法。

        对于**类的变量和函数**的介绍应在类的声明处进行解释。

        在**流程处理**的代码中应分处理模块进行解释，注释放在模块执行前。

        对于**可行性想法**的注释应放在相应内容模块结束**后一行**，添加“==”进行区域限定。

        **其他备注**采用“--”进行段囊括。

    3. 代码结构规范：

        对于重复性**功能代码**尽量封装为**函数**结构，未进行优化的应用**其他备注**的方式进行备注。

        对于重复性**选择代码**采用**策略模式**进行优化，可变性强的添加反射机制（如指令类），可变性弱的以函数指针+map方式进行功能选取（如窗体初始化）（需要设置为静态）。

    4. 配置文件规范：
    
        JSON文件的书写规范：
    
    5. 数据库规范：
    
        
    
* 额外添加的类：

    1. 测试模拟类：

        在语句间插桩，通过调用检查类中的方法进行测试的模拟。

    2. 异常处理类：

        尝试使用try和soluteError进行异常的处理，或者在TOOL层中内置异常的处理方法。

    3. 优化性能类：

        对于服务器的匹配-战斗处理的过程，可使用多线程进行处理，但需要注意socket消息传输和TCP粘包问题。